#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ADF (Augmented Dickey-Fuller) å¹³ç¨³æ€§æ£€éªŒå·¥å…·

æœ¬æ¨¡å—æä¾›äº†æ—¶é—´åºåˆ—å¹³ç¨³æ€§æ£€éªŒçš„åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºï¼š
1. æ£€éªŒæ—¶é—´åºåˆ—æ˜¯å¦å¹³ç¨³
2. ä¸ºARIMAæ¨¡å‹ç¡®å®šå·®åˆ†æ¬¡æ•°d
3. ç¡®ä¿æ—¶é—´åºåˆ—åˆ†æçš„æœ‰æ•ˆæ€§

ä½œè€…: AI Assistant
åˆ›å»ºæ—¶é—´: 2024
ç‰ˆæœ¬: 1.0
"""

import pandas as pd
from statsmodels.tsa.stattools import adfuller

def adf_test(series, title=''): 
    """
    å¯¹æ—¶é—´åºåˆ—è¿›è¡ŒADFæ£€éªŒï¼Œè¾“å‡ºè¯¦ç»†çš„æ£€éªŒç»“æœ
    
    ADFæ£€éªŒæ˜¯æ—¶é—´åºåˆ—åˆ†æä¸­æœ€å¸¸ç”¨çš„å¹³ç¨³æ€§æ£€éªŒæ–¹æ³•ä¹‹ä¸€ã€‚
    åŸå‡è®¾H0ï¼šæ—¶é—´åºåˆ—æ˜¯éå¹³ç¨³çš„ï¼ˆå­˜åœ¨å•ä½æ ¹ï¼‰
    å¤‡æ‹©å‡è®¾H1ï¼šæ—¶é—´åºåˆ—æ˜¯å¹³ç¨³çš„ï¼ˆä¸å­˜åœ¨å•ä½æ ¹ï¼‰
    
    å‚æ•°ï¼š
        series: pd.Series
            å¾…æ£€éªŒçš„æ—¶é—´åºåˆ—æ•°æ®
            å¿…é¡»æ˜¯ä¸€ç»´çš„æ—¶é—´åºåˆ—æ•°æ®
        title: str, é»˜è®¤ ''
            åºåˆ—åç§°ï¼Œç”¨äºè¾“å‡ºç»“æœçš„æ ‡è¯†
            å¦‚æœä¸ºç©ºï¼Œåˆ™åªæ˜¾ç¤º"ADFæ£€éªŒç»“æœ"
    
    è¿”å›ï¼š
        result: dict
            åŒ…å«ADFæ£€éªŒçš„ä¸»è¦ç»“æœï¼ŒåŒ…æ‹¬ï¼š
            - 'ADFç»Ÿè®¡é‡': ADFæ£€éªŒç»Ÿè®¡é‡
            - 'på€¼': æ˜¾è‘—æ€§æ°´å¹³
            - 'æ»åæ•°': è‡ªåŠ¨é€‰æ‹©çš„æ»åé˜¶æ•°
            - 'è§‚æµ‹å€¼æ•°': å‚ä¸æ£€éªŒçš„è§‚æµ‹å€¼æ•°é‡
    
    ç¤ºä¾‹ï¼š
        >>> import pandas as pd
        >>> from utils.adf import adf_test
        >>> 
        >>> # åˆ›å»ºç¤ºä¾‹æ—¶é—´åºåˆ—
        >>> data = pd.Series([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
        >>> result = adf_test(data, "ç¤ºä¾‹åºåˆ—")
        >>> 
        >>> # åˆ¤æ–­ç»“æœ
        >>> if result['på€¼'] < 0.05:
        >>>     print("åºåˆ—å¹³ç¨³ï¼Œå¯ä»¥è¿›è¡ŒARIMAå»ºæ¨¡")
        >>> else:
        >>>     print("åºåˆ—éå¹³ç¨³ï¼Œéœ€è¦è¿›è¡Œå·®åˆ†å¤„ç†")
    
    æ³¨æ„äº‹é¡¹ï¼š
        1. è¾“å…¥æ•°æ®å¿…é¡»æ˜¯pandas.Seriesç±»å‹
        2. æ•°æ®ä¸­ä¸èƒ½åŒ…å«æ— ç©·å¤§æˆ–NaNå€¼
        3. å»ºè®®åœ¨ARIMAå»ºæ¨¡å‰è¿›è¡Œæ­¤æ£€éªŒ
        4. på€¼å°äº0.05è¡¨ç¤ºåºåˆ—å¹³ç¨³ï¼ˆæ‹’ç»åŸå‡è®¾ï¼‰
    """
    # è¾“å…¥éªŒè¯
    if not isinstance(series, pd.Series):
        raise TypeError("è¾“å…¥æ•°æ®å¿…é¡»æ˜¯pandas.Seriesç±»å‹")
    
    if series.empty:
        raise ValueError("è¾“å…¥åºåˆ—ä¸èƒ½ä¸ºç©º")
    
    # ç§»é™¤NaNå€¼å¹¶æ‰§è¡ŒADFæ£€éªŒ
    # autolag='AIC'è¡¨ç¤ºä½¿ç”¨AICå‡†åˆ™è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ»åé˜¶æ•°
    print(f'\nADFæ£€éªŒç»“æœ: {title}')
    result = adfuller(series.dropna(), autolag='AIC')
    
    # æå–ä¸»è¦ç»“æœ
    labels = ['ADFç»Ÿè®¡é‡', 'på€¼', 'æ»åæ•°', 'è§‚æµ‹å€¼æ•°']
    out = dict(zip(labels, result[:4]))
    
    # è¾“å‡ºä¸»è¦ç»Ÿè®¡é‡
    for key, value in out.items():
        print(f'{key}: {value}')
    
    # è¾“å‡ºä¸´ç•Œå€¼ï¼ˆä¸åŒæ˜¾è‘—æ€§æ°´å¹³ä¸‹çš„ä¸´ç•Œå€¼ï¼‰
    for key, value in result[4].items():
        print(f'ä¸´ç•Œå€¼ {key}: {value}')
    
    # åˆ¤æ–­å¹³ç¨³æ€§å¹¶è¾“å‡ºç»“è®º
    if out['på€¼'] < 0.05:
        print('âœ… åºåˆ—å¹³ç¨³ï¼ˆæ‹’ç»åŸå‡è®¾ï¼‰')
        print('ğŸ’¡ å»ºè®®ï¼šå¯ä»¥ç›´æ¥è¿›è¡ŒARIMAå»ºæ¨¡ï¼Œå·®åˆ†æ¬¡æ•°d=0')
    else:
        print('âŒ åºåˆ—éå¹³ç¨³ï¼ˆä¸èƒ½æ‹’ç»åŸå‡è®¾ï¼‰')
        print('ğŸ’¡ å»ºè®®ï¼šéœ€è¦è¿›è¡Œå·®åˆ†å¤„ç†ï¼Œå·®åˆ†æ¬¡æ•°d>0')
    
    return out 